# Инструкция по использованию Telegram-бота для электрика

## 1. Как запустить и остановить Telegram-бота

### Запуск бота

1. Откройте командную строку (терминал) в папке с проектом
2. Убедитесь, что установлены все зависимости из файла `requirements.txt`:
   ```
   pip install -r requirements.txt
   ```
3. Проверьте файл `.env` - он должен содержать правильный токен бота и ID администраторов:
   ```
   BOT_TOKEN=ваш_токен_бота
   ADMIN_IDS=ваши_ID_администраторов_через_запятую
   GOOGLE_SERVICE_ACCOUNT_FILE=service_account.json
   GOOGLE_SPREADSHEET_ID=ID_вашей_Google_таблицы
   ```
4. Запустите бота командой:
   ```
   python main.py
   ```
5. Если всё настроено правильно, вы увидите сообщение "Bot started!"

### Остановка бота

1. Чтобы остановить бота, нажмите `Ctrl+C` в терминале
2. Вы увидите сообщение "Bot stopped!"

## 2. Как изменить тексты бота

Все тексты бота хранятся в файле `messages.json`. Чтобы изменить текст:

1. Откройте файл `messages.json` в любом текстовом редакторе
2. Найдите нужное сообщение по ключу (например, "WELCOME_MESSAGE" для приветственного сообщения)
3. Измените текст справа от двоеточия, сохраняя кавычки
4. Сохраните файл
5. Перезапустите бота для применения изменений

Пример изменения приветственного сообщения:
```json
{
    "WELCOME_MESSAGE": "Новый текст приветствия здесь",
    // ... другие сообщения
}
```

Основные текстовые ключи:
- `"WELCOME_MESSAGE"` - Приветственное сообщение
- `"CLIENT_*"` - Сообщения для клиентов
- `"PARTNER_*"` - Сообщения для партнеров
- `"BTN_*"` - Тексты кнопок
- `"STATUS_*"` - Статусы заявок

## 3. Работа с таблицей Google Sheets

### Доступ к таблице

Таблица Google Sheets находится по адресу, указанному в файле `.env` в переменной `GOOGLE_SPREADSHEET_ID`. 
Вы можете получить доступ к таблице через Google Sheets, используя аккаунт, связанный с service account.

### Фильтрация клиентов и партнеров

В таблице заявки автоматически сортируются:
- Клиенты имеют значение "Заказчик" в столбце "Тип пользователя"
- Партнеры имеют значение "Партнер" в столбце "Тип пользователя"

Для фильтрации:
1. Нажмите на стрелку фильтра в заголовке столбца "Тип пользователя"
2. Выберите нужный тип (Заказчик или Партнер)
3. Нажмите "ОК"

### Изменение статусов заявок

Статусы заявок можно изменять вручную в таблице Google Sheets:

1. Найдите нужную заявку в таблице
2. Перейдите в столбец "Статус заявки" (обычно это столбец с названием "Статус заявки")
3. Щелкните по ячейке со статусом
4. Выберите новый статус из списка:
   - "Новая"
   - "Осмотр назначен"
   - "Смета готова"
   - "В работе"
   - "Готово"
   - "Оплачено"
   - "Отменено"
5. Нажмите Enter для сохранения

### Как работают уведомления

Бот автоматически отправляет уведомления при изменении статуса заявки:

1. Бот проверяет таблицу каждые 60 секунд
2. При обнаружении изменения статуса заявки:
   - Бот отправляет уведомление пользователю в Telegram
   - Уведомление содержит информацию о новом статусе и комментарии из таблицы
3. Администраторы также получают уведомления о новых заявках:
   - Клиенты: структурированное сообщение с типом "Тип заявки: КЛИЕНТ"
   - Партнеры: подробное сообщение с информацией об объекте и условиях партнерства

Уведомления отправляются только при изменении статуса, а не при других изменениях в таблице.
